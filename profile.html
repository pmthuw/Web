<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>H·ªì s∆° c√° nh√¢n</title>
  <style>
    body { 
      font-family: sans-serif; 
      background-color: #fff6fa; 
      text-align: center;
    }

    .profile-card {
      margin: 80px auto; 
      padding: 30px; 
      width: 400px;
      background: white; 
      border: 2px solid #ffb6c1; 
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: left;
    }

    .profile-card img { 
      display: block;
      margin: 0 auto 10px auto; 
      width: 100px; 
      height: 100px; 
      border-radius: 50%; 
      border: 3px solid pink; 
    }

    h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    p {
      margin: 8px 0;
    }

    input[type="text"],
    input[type="password"] {
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 180px;
      margin-left: 6px;
    }

    button { 
      display: inline-block;
      margin-top: 8px;
      background: #ffc4d5; 
      color: white; 
      border: none; 
      border-radius: 8px; 
      padding: 6px 10px; 
      cursor: pointer; 
    }

    button:hover {
      background: #edc4cf;
    }

    .center-text {
      text-align: center;
      margin-top: 15px;
    }

    .hidden {
      display: none;
    }

    .password-box {
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="profile-card">
    <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="Avatar">
    <h2 id="userName"></h2>

    <p><b>Email:</b> <span id="userEmail"></span></p>
    <p id="phoneSection"></p>
    <p id="addressSection"></p>
    <p><b>Ng√†y tham gia:</b> <span id="userJoin"></span></p>

    <!-- Reset m·∫≠t kh·∫©u -->
    <div id="resetSection">
      <button id="toggleResetBtn">ƒê·ªïi m·∫≠t kh·∫©u</button>
      <div id="resetForm" class="hidden">
        <div class="password-box">
          <input type="password" id="oldPass" placeholder="M·∫≠t kh·∫©u c≈©">
        </div>
        <div class="password-box">
          <input type="password" id="newPass" placeholder="M·∫≠t kh·∫©u m·ªõi">
        </div>
        <button id="savePassBtn">L∆∞u m·∫≠t kh·∫©u</button>
      </div>
    </div>

    <div class="center-text">
      <button id="logoutBtn">ƒêƒÉng xu·∫•t</button>
    </div>
  </div>

  <script>
    // L·∫•y th√¥ng tin ng∆∞·ªùi d√πng
    const user = JSON.parse(localStorage.getItem("currentUser"));
    if (!user) {
      alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p tr∆∞·ªõc!");
      window.location.href = "login.html";
    }

    // G√°n gi√° tr·ªã m·∫∑c ƒë·ªãnh
    user.phone = user.phone || "";
    user.address = user.address || "";

    // Hi·ªÉn th·ªã th√¥ng tin c∆° b·∫£n
    document.getElementById("userName").textContent = user.name;
    document.getElementById("userEmail").textContent = user.email;
    document.getElementById("userJoin").textContent = user.joinDate;

    const phoneSection = document.getElementById("phoneSection");
    const addressSection = document.getElementById("addressSection");
    const resetForm = document.getElementById("resetForm");
    const toggleResetBtn = document.getElementById("toggleResetBtn");

    // Hi·ªÉn th·ªã / nh·∫≠p SƒêT
    function renderPhone() {
      if (user.phone.trim() !== "") {
        phoneSection.innerHTML = `<b>SƒêT:</b> ${user.phone}`;
      } else {
        phoneSection.innerHTML = `
          <b>SƒêT:</b>
          <input type="text" id="phoneInput" placeholder="Nh·∫≠p SƒêT">
          <button id="savePhoneBtn">L∆∞u</button>
        `;
        document.getElementById("savePhoneBtn").addEventListener("click", () => {
          const newPhone = document.getElementById("phoneInput").value.trim();
          if (newPhone === "") {
            alert("Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!");
            return;
          }
          user.phone = newPhone;
          localStorage.setItem("currentUser", JSON.stringify(user));
          renderPhone();
        });
      }
    }

    // Hi·ªÉn th·ªã / nh·∫≠p ƒë·ªãa ch·ªâ
    function renderAddress() {
      if (user.address.trim() !== "") {
        addressSection.innerHTML = `<b>ƒê·ªãa ch·ªâ nh·∫≠n h√†ng:</b> ${user.address}`;
      } else {
        addressSection.innerHTML = `
          <b>ƒê·ªãa ch·ªâ nh·∫≠n h√†ng:</b>
          <input type="text" id="addressInput" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
          <button id="saveAddressBtn">L∆∞u</button>
        `;
        document.getElementById("saveAddressBtn").addEventListener("click", () => {
          const newAddress = document.getElementById("addressInput").value.trim();
          if (newAddress === "") {
            alert("Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ nh·∫≠n h√†ng!");
            return;
          }
          user.address = newAddress;
          localStorage.setItem("currentUser", JSON.stringify(user));
          renderAddress();
        });
      }
    }

    renderPhone();
    renderAddress();

    // --- Kh√≥a / m·ªü kh√≥a ƒë·ªïi m·∫≠t kh·∫©u ---
    let resetUnlocked = false;

    toggleResetBtn.addEventListener("click", () => {
      resetUnlocked = !resetUnlocked;
      if (resetUnlocked) {
        toggleResetBtn.textContent = "üîì Kh√≥a ƒë·ªïi m·∫≠t kh·∫©u";
        resetForm.classList.remove("hidden");
      } else {
        toggleResetBtn.textContent = "üîí M·ªü kh√≥a ƒë·ªïi m·∫≠t kh·∫©u";
        resetForm.classList.add("hidden");
      }
    });

    // --- L∆∞u m·∫≠t kh·∫©u m·ªõi ---
    document.getElementById("savePassBtn").addEventListener("click", () => {
      const oldPass = document.getElementById("oldPass").value.trim();
      const newPass = document.getElementById("newPass").value.trim();

      if (oldPass === "" || newPass === "") {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß m·∫≠t kh·∫©u!");
        return;
      }

      if (oldPass !== user.password) {
        alert("M·∫≠t kh·∫©u c≈© kh√¥ng ƒë√∫ng!");
        return;
      }

      user.password = newPass;
      localStorage.setItem("currentUser", JSON.stringify(user));
      alert("‚úÖ ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!");
      document.getElementById("oldPass").value = "";
      document.getElementById("newPass").value = "";
      resetUnlocked = false;
      toggleResetBtn.textContent = "ƒê·ªïi m·∫≠t kh·∫©u";
      resetForm.classList.add("hidden");
    });

    // --- ƒêƒÉng xu·∫•t ---
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("currentUser");
      window.location.href = "login.html";
    });
  </script>
</body>
</html>
